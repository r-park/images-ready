{"version":3,"sources":["jquery-imagesready.min.js"],"names":["root","factory","define","amd","exports","module","imagesReady","this","status","total","done","loaded","verified","update","ImagesReady","elements","options","document","querySelectorAll","length","Error","deferred","defer","jquery","images","imageElements","validElements","toArray","VALID_NODE_TYPES","imageCount","verify","resolve","reject","instance","result",1,9,11,"prototype","$","Deferred","promise","Promise","forEach","element","nodeName","push","n","l","validNodeTypes","filter","nodeType","incompleteImages","image","complete","naturalWidth","proxyImage","onload","onerror","_image","Image","addEventListener","src","incomplete","object","Array","isArray","slice","call","window","jQuery","fn"],"mappings":"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","file":"jquery-imagesready.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.imagesReady = factory();\n  }\n}(this, function() {\n'use strict';\n\n\n/**\n * @param {number} total\n * @param {function} done\n * @returns {{update: function}}\n */\nfunction status(total, done) {\n  var status = {\n    loaded: 0,\n    total: total,\n    verified: 0\n  };\n\n  return {\n\n    /**\n     * @param {number} loaded\n     */\n    update : function(loaded) {\n      if (loaded) {\n        status.loaded += loaded;\n        status.verified += loaded;\n      }\n      else {\n        status.verified++;\n      }\n\n      if (status.total === status.verified) {\n        done(status);\n      }\n    }\n\n  };\n}\n\n\n/**\n * @name ImagesReady\n * @constructor\n *\n * @param {DocumentFragment|Element|Element[]|jQuery|NodeList|string} elements\n * @param {{}} [options]\n * @param {boolean} [options.jquery=false]\n *\n */\nfunction ImagesReady(elements, options) {\n  if (typeof elements === 'string') {\n    elements = document.querySelectorAll(elements);\n    if (!elements.length) {\n      throw new Error('selector `' + elements + '` yielded 0 elements');\n    }\n  }\n\n  var deferred = this.defer(options && options.jquery);\n\n  var images = this.imageElements(\n    this.validElements(this.toArray(elements), ImagesReady.VALID_NODE_TYPES)\n  );\n\n  var imageCount = images.length;\n\n  if (imageCount) {\n    this.verify(images, status(imageCount, function(status){\n      if (status.total === status.loaded) {\n        deferred.resolve(elements);\n      }\n      else {\n        deferred.reject(elements);\n      }\n    }));\n  }\n  else {\n    deferred.resolve(elements);\n  }\n}\n\n\nImagesReady.VALID_NODE_TYPES = {\n  1  : true, // ELEMENT_NODE\n  9  : true, // DOCUMENT_NODE\n  11 : true  // DOCUMENT_FRAGMENT_NODE\n};\n\n\nImagesReady.prototype = {\n\n  /**\n   * @param {boolean} jquery\n   * @returns deferred\n   */\n  defer : function(jquery) {\n    var deferred;\n\n    if (jquery) {\n      deferred = new $.Deferred();\n      this.result = deferred.promise();\n    }\n    else {\n      deferred = {};\n      deferred.promise = new Promise(function(resolve, reject){\n        deferred.resolve = resolve;\n        deferred.reject = reject;\n      });\n\n      this.result = deferred.promise;\n    }\n\n    return deferred;\n  },\n\n\n  /**\n   * @param {Element[]} elements\n   * @returns {[]|HTMLImageElement[]}\n   */\n  imageElements : function(elements) {\n    var images = [];\n\n    elements.forEach(function(element){\n      if (element.nodeName === 'IMG') {\n        images.push(element);\n      }\n      else {\n        var imageElements = element.querySelectorAll('img');\n        for (var n = 0, l = imageElements.length; n < l; ++n) {\n          images.push(imageElements[n]);\n        }\n      }\n    });\n\n    return images;\n  },\n\n\n  /**\n   * @param {Element[]} elements\n   * @param {{}} validNodeTypes\n   * @returns {[]|Element[]}\n   */\n  validElements : function(elements, validNodeTypes) {\n    return elements.filter(function(element){\n      return validNodeTypes[element.nodeType];\n    });\n  },\n\n\n  /**\n   * @param {HTMLImageElement[]} images\n   * @returns {[]|HTMLImageElement[]}\n   */\n  incompleteImages : function(images) {\n    return images.filter(function(image){\n      return !(image.complete && image.naturalWidth);\n    });\n  },\n\n\n  /**\n   * @param {function} onload\n   * @param {function} onerror\n   * @returns {function(HTMLImageElement)}\n   */\n  proxyImage : function(onload, onerror) {\n    return function(image) {\n      var _image = new Image();\n\n      _image.addEventListener('load', onload);\n      _image.addEventListener('error', onerror);\n      _image.src = image.src;\n\n      return _image;\n    };\n  },\n\n\n  /**\n   * @param {HTMLImageElement[]} images\n   * @param {{update: function}} status\n   */\n  verify : function(images, status) {\n    var incomplete = this.incompleteImages(images);\n\n    if (images.length !== incomplete.length) {\n      status.update(images.length - incomplete.length);\n    }\n\n    if (incomplete.length) {\n      incomplete.forEach(this.proxyImage(\n        function(){\n          status.update(1);\n        },\n        function(){\n          status.update(0);\n        }\n      ));\n    }\n  },\n\n\n  /**\n   * @param {DocumentFragment|Element|Element[]|jQuery|NodeList} object\n   * @returns {Element[]}\n   */\n  toArray : function(object) {\n    if (Array.isArray(object)) {\n      return object;\n    }\n\n    if (typeof object.length === 'number') {\n      return [].slice.call(object);\n    }\n\n    return [object];\n  }\n\n};\n\n\n/*=========================================================\n  jQuery plugin\n=========================================================*/\nif (window.jQuery) {\n  $.fn.imagesReady = function() {\n    var instance = new ImagesReady(this, {jquery: true});\n    return instance.result;\n  };\n}\n\n\n/*=========================================================\n  Default entry point\n=========================================================*/\nfunction imagesReady(elements) { // eslint-disable-line no-unused-vars\n  var instance = new ImagesReady(elements);\n  return instance.result;\n}\n\nreturn imagesReady;\n}));\n"],"sourceRoot":"/source/"}