{"version":3,"sources":["jquery-imagesready.min.js"],"names":["root","factory","define","amd","exports","module","imagesReady","this","ImagesReady","elements","jquery","document","querySelectorAll","length","Error","deferred","defer","result","promise","images","imageElements","validElements","toArray","VALID_NODE_TYPES","imageCount","verify","status","ready","resolve","reject","$","Deferred","Promise","done","update","total","verified","loaded","failed","count","instance",1,9,11,"prototype","forEach","element","nodeName","push","apply","validNodeTypes","filter","nodeType","incompleteImages","image","complete","naturalWidth","proxyImage","onload","onerror","_image","Image","addEventListener","src","incomplete","object","Array","isArray","slice","call","window","jQuery","fn"],"mappings":"CAAE,SAASA,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACiB,gBAAZG,SAChBC,OAAOD,QAAUH,IAEjBD,EAAKM,YAAcL,KAErBM,KAAM,WACR,YAWA,SAASC,GAAYC,EAAUC,GAC7B,GAAwB,gBAAbD,KACTA,EAAWE,SAASC,iBAAiBH,IAChCA,EAASI,QACZ,KAAM,IAAIC,OAAM,aAAeL,EAAW,uBAI9C,IAAIM,GAAWC,EAAMN,EACrBH,MAAKU,OAASF,EAASG,OAEvB,IAAIC,GAASZ,KAAKa,cAChBb,KAAKc,cAAcd,KAAKe,QAAQb,GAAWD,EAAYe,mBAGrDC,EAAaL,EAAON,MAEpBW,GACFjB,KAAKkB,OAAON,EAAQO,EAAOF,EAAY,SAASG,GAC1CA,EACFZ,EAASa,QAAQnB,GAGjBM,EAASc,OAAOpB,MAKpBM,EAASa,QAAQnB,GA6HrB,QAASO,GAAMN,GACb,GAAIK,EAcJ,OAZIL,IACFK,EAAW,GAAIe,GAAEC,SACjBhB,EAASG,QAAUH,EAASG,YAG5BH,KACAA,EAASG,QAAU,GAAIc,SAAQ,SAASJ,EAASC,GAC/Cd,EAASa,QAAUA,EACnBb,EAASc,OAASA,KAIfd,EAST,QAASW,GAAOF,EAAYS,GAK1B,QAASC,KACHC,IAAUC,GACZH,EAAKE,IAAUE,GANnB,GAAIA,GAAS,EACTF,EAAQX,EACRY,EAAW,CAQf,QAKEE,OAAS,SAASC,GAChBH,GAAYG,EACZL,KAMFG,OAAS,SAASE,GAChBF,GAAUE,EACVH,GAAYG,EACZL,MAsBN,QAAS5B,GAAYG,GACnB,GAAI+B,GAAW,GAAIhC,GAAYC,EAC/B,OAAO+B,GAASvB,OAGlB,MAtMAT,GAAYe,kBACVkB,GAAK,EACLC,GAAK,EACLC,IAAK,GAIPnC,EAAYoC,WAMVxB,cAAgB,SAASX,GACvB,GAAIU,KAcJ,OAZAV,GAASoC,QAAQ,SAASC,GACxB,GAAyB,QAArBA,EAAQC,SACV5B,EAAO6B,KAAKF,OAET,CACH,GAAI1B,GAAgB0B,EAAQlC,iBAAiB,MACzCQ,GAAcP,QAChBM,EAAO6B,KAAKC,MAAM9B,EAAQC,MAKzBD,GASTE,cAAgB,SAASZ,EAAUyC,GACjC,MAAOzC,GAAS0C,OAAO,SAASL,GAC9B,MAAOI,GAAeJ,EAAQM,aASlCC,iBAAmB,SAASlC,GAC1B,MAAOA,GAAOgC,OAAO,SAASG,GAC5B,QAASA,EAAMC,UAAYD,EAAME,iBAUrCC,WAAa,SAASC,EAAQC,GAC5B,MAAO,UAASL,GACd,GAAIM,GAAS,GAAIC,MAMjB,OAJAD,GAAOE,iBAAiB,OAAQJ,GAChCE,EAAOE,iBAAiB,QAASH,GACjCC,EAAOG,IAAMT,EAAMS,IAEZH,IASXnC,OAAS,SAASN,EAAQO,GACxB,GAAIsC,GAAazD,KAAK8C,iBAAiBlC,EAEnCA,GAAON,OAASmD,EAAWnD,QAC7Ba,EAAOW,OAAOlB,EAAON,OAASmD,EAAWnD,QAGvCmD,EAAWnD,QACbmD,EAAWnB,QAAQtC,KAAKkD,WACtB,WACE/B,EAAOW,OAAO,IAEhB,WACEX,EAAOY,OAAO,OAWtBhB,QAAU,SAAS2C,GACjB,MAAIC,OAAMC,QAAQF,GACTA,EAGoB,gBAAlBA,GAAOpD,UACNuD,MAAMC,KAAKJ,IAGfA,KAwERK,OAAOC,SACTzC,EAAE0C,GAAGlE,YAAc,WACjB,GAAIkC,GAAW,GAAIhC,GAAYD,MAAM,EACrC,OAAOiC,GAASvB,SAabX","file":"jquery-imagesready.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.imagesReady = factory();\n  }\n}(this, function() {\n'use strict';\n\n\n/**\n * @name ImagesReady\n * @constructor\n *\n * @param {DocumentFragment|Element|Element[]|jQuery|NodeList|string} elements\n * @param {boolean} jquery\n *\n */\nfunction ImagesReady(elements, jquery) {\n  if (typeof elements === 'string') {\n    elements = document.querySelectorAll(elements);\n    if (!elements.length) {\n      throw new Error('selector `' + elements + '` yielded 0 elements');\n    }\n  }\n\n  var deferred = defer(jquery);\n  this.result = deferred.promise;\n\n  var images = this.imageElements(\n    this.validElements(this.toArray(elements), ImagesReady.VALID_NODE_TYPES)\n  );\n\n  var imageCount = images.length;\n\n  if (imageCount) {\n    this.verify(images, status(imageCount, function(ready){\n      if (ready) {\n        deferred.resolve(elements);\n      }\n      else {\n        deferred.reject(elements);\n      }\n    }));\n  }\n  else {\n    deferred.resolve(elements);\n  }\n}\n\n\nImagesReady.VALID_NODE_TYPES = {\n  1  : true, // ELEMENT_NODE\n  9  : true, // DOCUMENT_NODE\n  11 : true  // DOCUMENT_FRAGMENT_NODE\n};\n\n\nImagesReady.prototype = {\n\n  /**\n   * @param {Element[]} elements\n   * @returns {[]|HTMLImageElement[]}\n   */\n  imageElements : function(elements) {\n    var images = [];\n\n    elements.forEach(function(element){\n      if (element.nodeName === 'IMG') {\n        images.push(element);\n      }\n      else {\n        var imageElements = element.querySelectorAll('img');\n        if (imageElements.length) {\n          images.push.apply(images, imageElements);\n        }\n      }\n    });\n\n    return images;\n  },\n\n\n  /**\n   * @param {Element[]} elements\n   * @param {{}} validNodeTypes\n   * @returns {[]|Element[]}\n   */\n  validElements : function(elements, validNodeTypes) {\n    return elements.filter(function(element){\n      return validNodeTypes[element.nodeType];\n    });\n  },\n\n\n  /**\n   * @param {HTMLImageElement[]} images\n   * @returns {[]|HTMLImageElement[]}\n   */\n  incompleteImages : function(images) {\n    return images.filter(function(image){\n      return !(image.complete && image.naturalWidth);\n    });\n  },\n\n\n  /**\n   * @param {function} onload\n   * @param {function} onerror\n   * @returns {function(HTMLImageElement)}\n   */\n  proxyImage : function(onload, onerror) {\n    return function(image) {\n      var _image = new Image();\n\n      _image.addEventListener('load', onload);\n      _image.addEventListener('error', onerror);\n      _image.src = image.src;\n\n      return _image;\n    };\n  },\n\n\n  /**\n   * @param {HTMLImageElement[]} images\n   * @param {{failed: function, loaded: function}} status\n   */\n  verify : function(images, status) {\n    var incomplete = this.incompleteImages(images);\n\n    if (images.length > incomplete.length) {\n      status.loaded(images.length - incomplete.length);\n    }\n\n    if (incomplete.length) {\n      incomplete.forEach(this.proxyImage(\n        function(){\n          status.loaded(1);\n        },\n        function(){\n          status.failed(1);\n        }\n      ));\n    }\n  },\n\n\n  /**\n   * @param {DocumentFragment|Element|Element[]|jQuery|NodeList} object\n   * @returns {Element[]}\n   */\n  toArray : function(object) {\n    if (Array.isArray(object)) {\n      return object;\n    }\n\n    if (typeof object.length === 'number') {\n      return [].slice.call(object);\n    }\n\n    return [object];\n  }\n\n};\n\n\n/**\n * @param jquery\n * @returns deferred\n */\nfunction defer(jquery) {\n  var deferred;\n\n  if (jquery) {\n    deferred = new $.Deferred();\n    deferred.promise = deferred.promise();\n  }\n  else {\n    deferred = {};\n    deferred.promise = new Promise(function(resolve, reject){\n      deferred.resolve = resolve;\n      deferred.reject = reject;\n    });\n  }\n\n  return deferred;\n}\n\n\n/**\n * @param {number} imageCount\n * @param {function} done\n * @returns {{failed: function, loaded: function}}\n */\nfunction status(imageCount, done) {\n  var loaded = 0,\n      total = imageCount,\n      verified = 0;\n\n  function update() {\n    if (total === verified) {\n      done(total === loaded);\n    }\n  }\n\n  return {\n\n    /**\n     * @param {number} count\n     */\n    failed : function(count) {\n      verified += count;\n      update();\n    },\n\n    /**\n     * @param {number} count\n     */\n    loaded : function(count) {\n      loaded += count;\n      verified += count;\n      update();\n    }\n\n  };\n}\n\n\n\n/*=========================================================\n  jQuery plugin\n=========================================================*/\nif (window.jQuery) {\n  $.fn.imagesReady = function() {\n    var instance = new ImagesReady(this, true);\n    return instance.result;\n  };\n}\n\n\n/*=========================================================\n  Default entry point\n=========================================================*/\nfunction imagesReady(elements) { // eslint-disable-line no-unused-vars\n  var instance = new ImagesReady(elements);\n  return instance.result;\n}\n\nreturn imagesReady;\n}));\n"],"sourceRoot":"/source/"}