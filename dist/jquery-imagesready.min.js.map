{"version":3,"sources":["jquery-imagesready.min.js"],"names":["root","factory","define","amd","exports","module","imagesReady","this","ImagesReady","elements","options","document","querySelectorAll","length","Error","images","findImageElements","toList","total","defer","jquery","loaded","verified","auto","verify","deferred","resolve","instance","result","validNodeTypes",1,9,11,"prototype","$","Deferred","promise","Promise","reject","element","imageElements","i","nodeName","push","nodeType","n","l","update","clean","image","complete","naturalWidth","verifyByProxy","src","imageSrc","Image","that","cleanup","removeEventListener","onload","onerror","addEventListener","providedElements","object","window","jQuery","fn"],"mappings":"CAAE,SAASA,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACiB,gBAAZG,SAChBC,OAAOD,QAAUH,IAEjBD,EAAKM,YAAcL,KAErBM,KAAM,WACR,YAqBA,SAASC,GAAYC,EAAUC,GAG7B,GAFAA,EAAUA,MAEc,gBAAbD,KACTA,EAAWE,SAASC,iBAAiBH,IAChCA,EAASI,QACZ,KAAM,IAAIC,OAAM,yCAA2CL,EAAW,IAI1E,IAAIM,GAASR,KAAKS,kBAAkBT,KAAKU,OAAOR,IAC5CS,EAAQH,EAAOF,MAEnBN,MAAKY,MAAMT,EAAQU,QAEfL,EAAOF,QACTN,KAAKE,SAAWA,EAChBF,KAAKQ,OAASA,EACdR,KAAKW,MAAQA,EACbX,KAAKc,OAAS,EACdd,KAAKe,SAAW,EAEZZ,EAAQa,QAAS,GACnBhB,KAAKiB,UAIPjB,KAAKkB,SAASC,QAAQjB,GAsK1B,QAASH,GAAYG,GACnB,GAAIkB,GAAW,GAAInB,GAAYC,EAC/B,OAAOkB,GAASC,OArNlB,GAAIC,IACFC,GAAK,EACLC,GAAK,EACLC,IAAK,EAqNP,OAtKAxB,GAAYyB,WAKVd,MAAQ,SAASC,GACf,GAAIK,GACAG,CAEAR,IACFK,EAAW,GAAIS,GAAEC,SACjBP,EAASH,EAASW,YAGlBX,KACAA,EAASW,QAAU,GAAIC,SAAQ,SAASX,EAASY,GAC/Cb,EAASC,QAAUA,EACnBD,EAASa,OAASA,IAGpBV,EAASH,EAASW,SAGpB7B,KAAKkB,SAAWA,EAChBlB,KAAKqB,OAASA,GAQhBZ,kBAAoB,SAASP,GAM3B,IALA,GAEI8B,GACAC,EAHAzB,KACA0B,EAAIhC,EAASI,OAIV4B,KAGL,GAFAF,EAAU9B,EAASgC,GAEM,QAArBF,EAAQG,SACV3B,EAAO4B,KAAKJ,OAET,IAAIV,EAAeU,EAAQK,UAAW,CACzCJ,EAAgBD,EAAQ3B,iBAAiB,MACzC,KAAK,GAAIiC,GAAI,EAAGC,EAAIN,EAAc3B,OAAYiC,EAAJD,IAASA,EACjD9B,EAAO4B,KAAKH,EAAcK,IAKhC,MAAO9B,IAOTgC,OAAS,WACPxC,KAAKe,WAEDf,KAAKW,QAAUX,KAAKe,WAClBf,KAAKW,QAAUX,KAAKc,OACtBd,KAAKkB,SAASC,QAAQnB,KAAKE,UAG3BF,KAAKkB,SAASa,OAAO/B,KAAKE,UAG5BF,KAAKyC,UAQTxB,OAAS,WAKP,IAJA,GAEIyB,GAFAlC,EAASR,KAAKQ,OACd0B,EAAI1B,EAAOF,OAGR4B,KACLQ,EAAQlC,EAAO0B,GAEXQ,EAAMC,UAAYD,EAAME,cAC1B5C,KAAKc,SACLd,KAAKwC,UAGLxC,KAAK6C,cAAcH,EAAMI,MAS/BD,cAAgB,SAASE,GACvB,GAAIL,GAAQ,GAAIM,OACZC,EAAOjD,KAEPkD,EAAU,WACZR,EAAMS,oBAAoB,OAAQC,QAClCV,EAAMS,oBAAoB,OAAQE,SAClCX,EAAQ,KAGVA,GAAMY,iBAAiB,OAAQ,WAC7BL,EAAKnC,SACLmC,EAAKT,SACLU,MAGFR,EAAMY,iBAAiB,QAAS,WAC9BL,EAAKT,SACLU,MAGFR,EAAMI,IAAMC,GAOdN,MAAQ,WACNzC,KAAKE,SAAW,KAChBF,KAAKQ,OAAS,KACdR,KAAKuD,iBAAmB,MAQ1B7C,OAAS,SAAS8C,GAChB,MAA6B,gBAAlBA,GAAOlD,OAA4BkD,GACtCA,KASRC,OAAOC,SACT/B,EAAEgC,GAAG5D,YAAc,WACjB,GAAIqB,GAAW,GAAInB,GAAYD,MAAOa,QAAQ,GAC9C,OAAOO,GAASC,SAabtB","file":"jquery-imagesready.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.imagesReady = factory();\n  }\n}(this, function() {\n'use strict';\n\n\nvar validNodeTypes = {\n  1  : true, // ELEMENT_NODE\n  9  : true, // DOCUMENT_NODE\n  11 : true  // DOCUMENT_FRAGMENT_NODE\n};\n\n\n/**\n * @name ImagesReady\n * @constructor\n *\n * @param {DocumentFragment|Element|Element[]|jQuery|NodeList|string} elements\n *\n * @param {{}}      [options]\n * @param {boolean} [options.auto] - used for testing only\n * @param {boolean} [options.jquery]\n *\n */\nfunction ImagesReady(elements, options) {\n  options = options || {};\n\n  if (typeof elements === 'string') {\n    elements = document.querySelectorAll(elements);\n    if (!elements.length) {\n      throw new Error('0 elements were found using selector `' + elements + '`');\n    }\n  }\n\n  var images = this.findImageElements(this.toList(elements));\n  var total = images.length;\n\n  this.defer(options.jquery);\n\n  if (images.length) {\n    this.elements = elements;\n    this.images = images;\n    this.total = total;\n    this.loaded = 0;\n    this.verified = 0;\n\n    if (options.auto !== false) {\n      this.verify();\n    }\n  }\n  else {\n    this.deferred.resolve(elements);\n  }\n}\n\n\nImagesReady.prototype = {\n\n  /**\n   * @param {boolean} jquery\n   */\n  defer : function(jquery) {\n    var deferred,\n        result;\n\n    if (jquery) {\n      deferred = new $.Deferred();\n      result = deferred.promise();\n    }\n    else {\n      deferred = {};\n      deferred.promise = new Promise(function(resolve, reject){\n        deferred.resolve = resolve;\n        deferred.reject = reject;\n      });\n\n      result = deferred.promise;\n    }\n\n    this.deferred = deferred;\n    this.result = result;\n  },\n\n\n  /**\n   * @param {Element[]} elements\n   * @returns {HTMLImageElement[]}\n   */\n  findImageElements : function(elements) {\n    var images = [],\n        i = elements.length,\n        element,\n        imageElements;\n\n    while (i--) {\n      element = elements[i];\n\n      if (element.nodeName === 'IMG') {\n        images.push(element);\n      }\n      else if (validNodeTypes[element.nodeType]) {\n        imageElements = element.querySelectorAll('img');\n        for (var n = 0, l = imageElements.length; n < l; ++n) {\n          images.push(imageElements[n]);\n        }\n      }\n    }\n\n    return images;\n  },\n\n\n  /**\n   *\n   */\n  update : function() {\n    this.verified++;\n\n    if (this.total === this.verified) {\n      if (this.total === this.loaded) {\n        this.deferred.resolve(this.elements);\n      }\n      else {\n        this.deferred.reject(this.elements);\n      }\n\n      this.clean();\n    }\n  },\n\n\n  /**\n   *\n   */\n  verify : function() {\n    var images = this.images,\n        i = images.length,\n        image;\n\n    while (i--) {\n      image = images[i];\n\n      if (image.complete && image.naturalWidth) {\n        this.loaded++;\n        this.update();\n      }\n      else {\n        this.verifyByProxy(image.src);\n      }\n    }\n  },\n\n\n  /**\n   * @param {string} imageSrc\n   */\n  verifyByProxy : function(imageSrc) {\n    var image = new Image(),\n        that = this;\n\n    var cleanup = function() {\n      image.removeEventListener('load', onload);\n      image.removeEventListener('load', onerror);\n      image = null;\n    };\n\n    image.addEventListener('load', function onload(){\n      that.loaded++;\n      that.update();\n      cleanup();\n    });\n\n    image.addEventListener('error', function onerror(){\n      that.update();\n      cleanup();\n    });\n\n    image.src = imageSrc;\n  },\n\n\n  /**\n   *\n   */\n  clean : function() {\n    this.elements = null;\n    this.images = null;\n    this.providedElements = null;\n  },\n\n\n  /**\n   * @param {Element|Element[]|jQuery|NodeList} object\n   * @returns {Element[]|jQuery|NodeList}\n   */\n  toList : function(object) {\n    if (typeof object.length === 'number') return object;\n    return [object];\n  }\n\n};\n\n\n/*=========================================================\n  jQuery plugin\n=========================================================*/\nif (window.jQuery) {\n  $.fn.imagesReady = function() {\n    var instance = new ImagesReady(this, {jquery: true}); // eslint-disable-line no-shadow\n    return instance.result;\n  };\n}\n\n\n/*=========================================================\n  Default entry point\n=========================================================*/\nfunction imagesReady(elements) { // eslint-disable-line no-unused-vars\n  var instance = new ImagesReady(elements);\n  return instance.result;\n}\n\nreturn imagesReady;\n}));\n"],"sourceRoot":"/source/"}