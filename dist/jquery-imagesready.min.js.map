{"version":3,"sources":["jquery-imagesready.min.js"],"names":["root","factory","define","amd","exports","module","imagesReady","this","status","imageCount","done","update","total","verified","loaded","failed","count","ImagesReady","elements","options","document","querySelectorAll","length","Error","deferred","defer","jquery","images","imageElements","validElements","toArray","VALID_NODE_TYPES","verify","ready","resolve","reject","instance","result",1,9,11,"prototype","$","Deferred","promise","Promise","forEach","element","nodeName","push","n","l","validNodeTypes","filter","nodeType","incompleteImages","image","complete","naturalWidth","proxyImage","onload","onerror","_image","Image","addEventListener","src","incomplete","object","Array","isArray","slice","call","window","jQuery","fn"],"mappings":"CAAE,SAASA,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACiB,gBAAZG,SAChBC,OAAOD,QAAUH,IAEjBD,EAAKM,YAAcL,KAErBM,KAAM,WACR,YAQA,SAASC,GAAOC,EAAYC,GAK1B,QAASC,KACHC,IAAUC,GACZH,EAAKE,IAAUE,GANnB,GAAIA,GAAS,EACTF,EAAQH,EACRI,EAAW,CAQf,QAKEE,OAAS,SAASC,GAChBH,GAAYG,EACZL,KAOFG,OAAS,SAASE,GAChBF,GAAUE,EACVH,GAAYG,EACZL,MAgBN,QAASM,GAAYC,EAAUC,GAC7B,GAAwB,gBAAbD,KACTA,EAAWE,SAASC,iBAAiBH,IAChCA,EAASI,QACZ,KAAM,IAAIC,OAAM,aAAeL,EAAW,uBAI9C,IAAIM,GAAWjB,KAAKkB,MAAMN,GAAWA,EAAQO,QAEzCC,EAASpB,KAAKqB,cAChBrB,KAAKsB,cAActB,KAAKuB,QAAQZ,GAAWD,EAAYc,mBAGrDtB,EAAakB,EAAOL,MAEpBb,GACFF,KAAKyB,OAAOL,EAAQnB,EAAOC,EAAY,SAASwB,GAC1CA,EACFT,EAASU,QAAQhB,GAGjBM,EAASW,OAAOjB,MAKpBM,EAASU,QAAQhB,GAgKrB,QAASZ,GAAYY,GACnB,GAAIkB,GAAW,GAAInB,GAAYC,EAC/B,OAAOkB,GAASC,OAGlB,MAhKApB,GAAYc,kBACVO,GAAK,EACLC,GAAK,EACLC,IAAK,GAIPvB,EAAYwB,WAMVhB,MAAQ,SAASC,GACf,GAAIF,EAgBJ,OAdIE,IACFF,EAAW,GAAIkB,GAAEC,SACjBpC,KAAK8B,OAASb,EAASoB,YAGvBpB,KACAA,EAASoB,QAAU,GAAIC,SAAQ,SAASX,EAASC,GAC/CX,EAASU,QAAUA,EACnBV,EAASW,OAASA,IAGpB5B,KAAK8B,OAASb,EAASoB,SAGlBpB,GAQTI,cAAgB,SAASV,GACvB,GAAIS,KAcJ,OAZAT,GAAS4B,QAAQ,SAASC,GACxB,GAAyB,QAArBA,EAAQC,SACVrB,EAAOsB,KAAKF,OAIZ,KAAK,GADDnB,GAAgBmB,EAAQ1B,iBAAiB,OACpC6B,EAAI,EAAGC,EAAIvB,EAAcN,OAAY6B,EAAJD,IAASA,EACjDvB,EAAOsB,KAAKrB,EAAcsB,MAKzBvB,GASTE,cAAgB,SAASX,EAAUkC,GACjC,MAAOlC,GAASmC,OAAO,SAASN,GAC9B,MAAOK,GAAeL,EAAQO,aASlCC,iBAAmB,SAAS5B,GAC1B,MAAOA,GAAO0B,OAAO,SAASG,GAC5B,QAASA,EAAMC,UAAYD,EAAME,iBAUrCC,WAAa,SAASC,EAAQC,GAC5B,MAAO,UAASL,GACd,GAAIM,GAAS,GAAIC,MAMjB,OAJAD,GAAOE,iBAAiB,OAAQJ,GAChCE,EAAOE,iBAAiB,QAASH,GACjCC,EAAOG,IAAMT,EAAMS,IAEZH,IASX9B,OAAS,SAASL,EAAQnB,GACxB,GAAI0D,GAAa3D,KAAKgD,iBAAiB5B,EAEnCA,GAAOL,OAAS4C,EAAW5C,QAC7Bd,EAAOM,OAAOa,EAAOL,OAAS4C,EAAW5C,QAGvC4C,EAAW5C,QACb4C,EAAWpB,QAAQvC,KAAKoD,WACtB,WACEnD,EAAOM,OAAO,IAEhB,WACEN,EAAOO,OAAO,OAWtBe,QAAU,SAASqC,GACjB,MAAIC,OAAMC,QAAQF,GACTA,EAGoB,gBAAlBA,GAAO7C,UACNgD,MAAMC,KAAKJ,IAGfA,KASRK,OAAOC,SACT/B,EAAEgC,GAAGpE,YAAc,WACjB,GAAI8B,GAAW,GAAInB,GAAYV,MAAOmB,QAAQ,GAC9C,OAAOU,GAASC,SAab/B","file":"jquery-imagesready.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.imagesReady = factory();\n  }\n}(this, function() {\n'use strict';\n\n\n/**\n * @param {number} imageCount\n * @param {function} done\n * @returns {{failed: function, loaded: function}}\n */\nfunction status(imageCount, done) {\n  var loaded = 0,\n      total = imageCount,\n      verified = 0;\n\n  function update() {\n    if (total === verified) {\n      done(total === loaded);\n    }\n  }\n\n  return {\n\n    /**\n     * @param {number} count\n     */\n    failed : function(count) {\n      verified += count;\n      update();\n    },\n\n\n    /**\n     * @param {number} count\n     */\n    loaded : function(count) {\n      loaded += count;\n      verified += count;\n      update();\n    }\n\n  };\n}\n\n\n/**\n * @name ImagesReady\n * @constructor\n *\n * @param {DocumentFragment|Element|Element[]|jQuery|NodeList|string} elements\n * @param {{}} [options]\n * @param {boolean} [options.jquery=false]\n *\n */\nfunction ImagesReady(elements, options) {\n  if (typeof elements === 'string') {\n    elements = document.querySelectorAll(elements);\n    if (!elements.length) {\n      throw new Error('selector `' + elements + '` yielded 0 elements');\n    }\n  }\n\n  var deferred = this.defer(options && options.jquery);\n\n  var images = this.imageElements(\n    this.validElements(this.toArray(elements), ImagesReady.VALID_NODE_TYPES)\n  );\n\n  var imageCount = images.length;\n\n  if (imageCount) {\n    this.verify(images, status(imageCount, function(ready){\n      if (ready) {\n        deferred.resolve(elements);\n      }\n      else {\n        deferred.reject(elements);\n      }\n    }));\n  }\n  else {\n    deferred.resolve(elements);\n  }\n}\n\n\nImagesReady.VALID_NODE_TYPES = {\n  1  : true, // ELEMENT_NODE\n  9  : true, // DOCUMENT_NODE\n  11 : true  // DOCUMENT_FRAGMENT_NODE\n};\n\n\nImagesReady.prototype = {\n\n  /**\n   * @param {boolean} jquery\n   * @returns deferred\n   */\n  defer : function(jquery) {\n    var deferred;\n\n    if (jquery) {\n      deferred = new $.Deferred();\n      this.result = deferred.promise();\n    }\n    else {\n      deferred = {};\n      deferred.promise = new Promise(function(resolve, reject){\n        deferred.resolve = resolve;\n        deferred.reject = reject;\n      });\n\n      this.result = deferred.promise;\n    }\n\n    return deferred;\n  },\n\n\n  /**\n   * @param {Element[]} elements\n   * @returns {[]|HTMLImageElement[]}\n   */\n  imageElements : function(elements) {\n    var images = [];\n\n    elements.forEach(function(element){\n      if (element.nodeName === 'IMG') {\n        images.push(element);\n      }\n      else {\n        var imageElements = element.querySelectorAll('img');\n        for (var n = 0, l = imageElements.length; n < l; ++n) {\n          images.push(imageElements[n]);\n        }\n      }\n    });\n\n    return images;\n  },\n\n\n  /**\n   * @param {Element[]} elements\n   * @param {{}} validNodeTypes\n   * @returns {[]|Element[]}\n   */\n  validElements : function(elements, validNodeTypes) {\n    return elements.filter(function(element){\n      return validNodeTypes[element.nodeType];\n    });\n  },\n\n\n  /**\n   * @param {HTMLImageElement[]} images\n   * @returns {[]|HTMLImageElement[]}\n   */\n  incompleteImages : function(images) {\n    return images.filter(function(image){\n      return !(image.complete && image.naturalWidth);\n    });\n  },\n\n\n  /**\n   * @param {function} onload\n   * @param {function} onerror\n   * @returns {function(HTMLImageElement)}\n   */\n  proxyImage : function(onload, onerror) {\n    return function(image) {\n      var _image = new Image();\n\n      _image.addEventListener('load', onload);\n      _image.addEventListener('error', onerror);\n      _image.src = image.src;\n\n      return _image;\n    };\n  },\n\n\n  /**\n   * @param {HTMLImageElement[]} images\n   * @param {{failed: function, loaded: function}} status\n   */\n  verify : function(images, status) {\n    var incomplete = this.incompleteImages(images);\n\n    if (images.length > incomplete.length) {\n      status.loaded(images.length - incomplete.length);\n    }\n\n    if (incomplete.length) {\n      incomplete.forEach(this.proxyImage(\n        function(){\n          status.loaded(1);\n        },\n        function(){\n          status.failed(1);\n        }\n      ));\n    }\n  },\n\n\n  /**\n   * @param {DocumentFragment|Element|Element[]|jQuery|NodeList} object\n   * @returns {Element[]}\n   */\n  toArray : function(object) {\n    if (Array.isArray(object)) {\n      return object;\n    }\n\n    if (typeof object.length === 'number') {\n      return [].slice.call(object);\n    }\n\n    return [object];\n  }\n\n};\n\n\n/*=========================================================\n  jQuery plugin\n=========================================================*/\nif (window.jQuery) {\n  $.fn.imagesReady = function() {\n    var instance = new ImagesReady(this, {jquery: true});\n    return instance.result;\n  };\n}\n\n\n/*=========================================================\n  Default entry point\n=========================================================*/\nfunction imagesReady(elements) { // eslint-disable-line no-unused-vars\n  var instance = new ImagesReady(elements);\n  return instance.result;\n}\n\nreturn imagesReady;\n}));\n"],"sourceRoot":"/source/"}